{{define "nav"}}
<li>
    <a href='#diagram'>
        <i class="fas fa-project-diagram"></i>
        Diagram
    </a>
</li>
<li>
    <a href='#columns'>
        <i class="fas fa-columns"></i>
        Columns</a>
</li>
<li>
    <a href='#foreignKeys'>
        <i class="fas fa-exchange-alt"></i>
        Foreign Keys</a>
</li>
<li>
    <a href='#data'>
        <i class="fas fa-table"></i>
        Data</a>
</li>
{{end}}

{{define "subheading"}}
<h2>
{{.Table.Name}}
    <i class="fas fa-table"></i>
</h2>
{{end}}

{{define "content"}}
{{if $.Database.Supports.Descriptions}}
<p>{{.Table.Description}}</p>
{{end}}
<h2 id="diagram">Nearest Tables</h2>
{{template "_diagram" .Diagram}}
<h2 id="columns">Columns</h2>
    <table>
        <thead>
        <tr>
            <th></th>
            <th>Name</th>
            <th>Type</th>
            <th>Foreign Key</th>
            {{if $.Database.Supports.Descriptions}}
            <th>Description</th>
            {{end}}
        </tr>
        </thead>
        {{ range .Table.Columns }}
        <tr>
            <td>{{ if .IsInPrimaryKey}}<i class="fas fa-key"></i> Primary Key{{end}}</td>
            <td>{{.Name}}</td>
            <td>{{.Type}}</td>
            <td>
            {{range .Fks }}
                <a href="{{.DestinationTable}}?_rowLimit=100">{{.DestinationTable}}</a>
                ({{.DestinationColumns}})
            {{end}}
            </td>
            {{if $.Database.Supports.Descriptions}}
            <td>{{.Description}}</td>
            {{end}}
        </tr>
        {{end}}
    </table>

<h2 id="foreignKeys">Foreign Keys</h2>

<div class="fk-list">
{{if .Table.Fks}}
<h3>Outbound</h3>
<table>
    <thead>
    <tr>
        {{if $.Database.Supports.FkNames}}
            <td>Name</td>
        {{end}}
        <th>From</th>
        <th>To</th>
    </tr>
    </thead>
    <tbody>
    {{range .Table.Fks}}
    <tr>
        {{if $.Database.Supports.FkNames}}
            <td>{{.Name}}</td>
        {{end}}
        <td>
        {{range .SourceColumns}}
            {{.Name}}
        {{end}}
        </td>
        <td>
            <a href="{{.DestinationTable}}?_rowLimit=100">{{.DestinationTable}}</a>
            ({{.DestinationColumns}})
        </td>
    </tr>
    {{end}}
    </tbody>
</table>
</div>
{{end}}

{{if .Table.InboundFks}}
<div class="fk-list">
<h3>Inbound</h3>
<table>
    <thead>
    <tr>
        {{if $.Database.Supports.FkNames}}
            <td>Name</td>
        {{end}}
        <th>From</th>
        <th>To</th>
    </tr>
    </thead>
    <tbody>
    {{range .Table.InboundFks}}
    <tr>
        {{if $.Database.Supports.FkNames}}
            <td>{{.Name}}</td>
        {{end}}
        <td>
            <a href="{{.SourceTable}}?_rowLimit=100">{{.SourceTable}}</a>
            ({{.DestinationColumns}})
        </td>
        <td>
            ({{.DestinationColumns}})
        </td>
    </tr>
    {{end}}
    </tbody>
</table>
</div>
{{end}}

<h2 id="data">Data</h2>

{{if .TableParams.CardView}}
<div class="table-button">
{{/*todo: need a url builder to avoid ending up with ?& if there's no query*/}}
    <a class="action-button button" href="?{{.TableParams.CardViewOff.AsQueryString}}#data">
        <i class="fas fa-table"> </i>
        Switch to table view</a>
</div>
{{else}}
<div class="table-button">
    <a class="action-button button" href="?{{.TableParams.CardViewOn.AsQueryString}}#data">
        <i class="fas fa-list"> </i>
        Switch to card view</a>
</div>
{{end}}
{{ if .TableParams.Filter }}
<div class="table-button">
    <a class="action-button button" href="?{{.TableParams.ClearFilter.AsQueryString}}#data">
        <i class="fas fa-times"></i>
        Clear Filter</a>
</div>
{{end}}
{{if .TableParams.Sort}}
<div class="table-button">
    <a class="action-button button" href="?{{.TableParams.ClearSort.AsQueryString}}#data">
        <i class="fas fa-sort"> </i>
        Reset Sort Order</a>
</div>
{{end}}

<div class="sort-filter-info">
{{ if .TableParams.Filter }}
    <table class='filter-info'>
        <thead>
        <tr>
            <th colspan="2">
                Filter
            </th>
        </tr>
        </thead>
        <tbody>
        {{ range .TableParams.Filter }}
        <tr>
            <th>
                {{.Field}}
            </th>
            <td>
                {{ range .Values }}
                {{.}}
                {{end}}
            </td>
        </tr>
        {{end}}
        </tbody>
    </table>
{{end}}
{{if .TableParams.CardView}}
    {{if .TableParams.Sort}}
        <table class="sort-info">
            <thead>
            <tr>
                <th colspan="2">
                    Sort
                </th>
            </tr>
            </thead>
            <tbody>
            {{ range .TableParams.Sort }}
            <tr>
                <td>
                    {{.Column}}
                </td>
                <td>
                    {{if .Descending}}
                        <i class="fas fa-sort-down"> </i>
                        Descending
                    {{else}}
                        <i class="fas fa-sort-up"> </i>
                        Ascending
                    {{end}}
                </td>
            </tr>
            {{end}}
            </tbody>
        </table>
    {{end}}
{{end}}
</div>

{{ if .TableParams.RowLimit }}
<p class='row-limit-info'>First {{.TableParams.RowLimit}} rows
    <small class="hint" style="margin-left: 0.75em;">
        <i class="fas fa-info-circle"></i>
        You can change the row limit in the address bar.</small><p>
{{end}}

{{if .TableParams.CardView}}
    <div class="cards">
    {{ range .Rows }}
        {{$val := .}}
        {{$refsLen := len .}}
        {{$refsIndex := minus $refsLen 1}}
        <table class="card-view">
            {{ range $i, $col :=  $.Table.Columns }}
                <tr>
                    <th title='type: {{.Type}}'>
                        {{ if .IsInPrimaryKey}}<i class="fas fa-key" title="Primary Key"></i>{{end}}
                        {{.Name}}
                    </th>
                    <td>{{index $val $i}}</td>
                </tr>
            {{end}}
            {{if $.Table.InboundFks}}
            <tr>
                <th class='references'>Referenced by</th>
                <td>{{index $val $refsIndex}}</td>
            </tr>
            {{end}}
        </table>
    {{end}}
    </div>
{{else}}
    <table class="data-table-view">
        <thead>
        <tr>
            {{ range .Table.Columns }}
                <th title='Field data type: {{.Type}}' class="sortable">
                    <a href="?{{($.TableParams.AddSort .).AsQueryString}}#data" class="fk">
                        <span class="sort-markers">
                            {{ if $.TableParams.IsSorted . }}
                                {{ if $.TableParams.IsSortedAsc . }}
                                    <i class="fas fa-sort-up"> </i>
                                    asc
                                {{end}}
                                {{ if $.TableParams.IsSortedDesc . }}
                                    <i class="fas fa-sort-down"> </i>
                                    desc
                                {{end}}
                                {{ $.TableParams.SortPosition . }}
                            {{else}}
                                <i class="fas fa-sort"> </i> sort
                            {{end}}
                        </span>
                        <span class="column-name">
                            {{.Name}}
                            {{ if .IsInPrimaryKey}}<i class="fas fa-key" title="Primary Key"></i>{{end}}
                        </span>
                    </a>
                </th>
            {{end}}
            {{if $.Table.InboundFks}}
                <th class='references'>Referenced by</th>
            {{end}}
        </tr>
        </thead>
        {{ range .Rows }}
            <tr>
                {{ range . }}
                <td>{{.}}</td>
                {{end}}
            </tr>
        {{end}}
    </table>
{{end}}

{{end}}
