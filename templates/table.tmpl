{{define "content"}}
<h2>
    <i class="fas fa-table"></i>
    {{.Table.Name}}
</h2>
<nav>
    <ul>
        <li>
            <a href='#diagram'>
                <i class="fas fa-project-diagram"></i>
                Diagram
            </a>
        </li>
        <li>
            <a href='#columns'>
                <i class="fas fa-columns"></i>
                Columns</a>
        </li>
        <li>
            <a href='#foreignKeys'>
                <i class="fas fa-exchange-alt"></i>
                Foreign Keys</a>
        </li>
        <li>
            <a href='#data'>
                <i class="fas fa-table"></i>
                Data</a>
        </li>
    </ul>
</nav>
{{if $.Database.Supports.Descriptions}}
<h2 id="description">Description</h2>
<p>{{.Table.Description}}</p>
{{end}}
<h2 id="diagram">Nearest Tables</h2>
{{template "_diagram" .Diagram}}
<h2 id="columns">Columns</h2>
    <table id="column-info">
        <thead>
        <tr>
            <th></th>
            <th>Name</th>
            <th>Type</th>
            <th>Nulls</th>
            <th>Outbound Foreign Key</th>
            <th>Inbound Foreign Keys</th>
            <th>Indexes</th>
            {{if $.Database.Supports.Descriptions}}
            <th>Description</th>
            {{end}}
        </tr>
        </thead>
        {{ range .Table.Columns }}
        <tr>
            <td><span class="bare-value">{{ if .IsInPrimaryKey}}<i class="fas fa-key"></i> Primary Key{{end}}</span></td>
            <td><span class="bare-value">{{.Name}}</span></td>
            <td><span class="bare-value">{{.Type}}</span></td>
            <td>
            {{if .Nullable}}
                <span class="bare-value nullable">
                    <i class="fas fa-chess-board"></i>
                    Nullable
                </span>
            {{else}}
                <span class="bare-value notnull">
                    <i class="fas fa-square-full"></i>
                    NOT NULL
                </span>
            {{end}}
            </span>
            </td>
            <td>
            {{range .Fks }}
                <a href="{{.DestinationTable}}?_rowLimit=100">
                    {{.DestinationTable}}({{.DestinationColumns}})
                </a>
            {{end}}
            </td>
            <td>
            {{range .InboundFks }}
                <a href="{{.SourceTable}}?_rowLimit=100">
                    {{.SourceTable}}({{.SourceColumns}})
                </a>
            {{end}}
            </td>
            <td>
            {{range .Indexes }}
                {{.Name}}
            {{end}}
            </td>
            {{if $.Database.Supports.Descriptions}}
            <td><span class="bare-value">{{.Description}}</span></td>
            {{end}}
        </tr>
        {{end}}
    </table>

<h2 id="foreignKeys">Foreign Keys</h2>

<div class="fk-list">
{{if .Table.Fks}}
<h3>Outbound</h3>
<table>
    <thead>
    <tr>
        {{if $.Database.Supports.FkNames}}
        <th>Name</th>
        {{end}}
        <th>From</th>
        <th>To</th>
    </tr>
    </thead>
    <tbody>
    {{range .Table.Fks}}
    <tr>
        {{if $.Database.Supports.FkNames}}
            <td><span class="bare-value">{{.Name}}</span></td>
        {{end}}
        <td><span class="bare-value">
        {{range .SourceColumns}}
            {{.Name}}
        {{end}}
        </span></td>
        <td>
            <a href="{{.DestinationTable}}?_rowLimit=100">
                {{.DestinationTable}}({{.DestinationColumns}})
            </a>
        </td>
    </tr>
    {{end}}
    </tbody>
</table>
</div>
{{end}}

{{if .Table.InboundFks}}
<div class="fk-list">
<h3>Inbound</h3>
<table>
    <thead>
    <tr>
        {{if $.Database.Supports.FkNames}}
        <td>Name</td>
        {{end}}
        <th>From</th>
        <th>To</th>
    </tr>
    </thead>
    <tbody>
    {{range .Table.InboundFks}}
    <tr>
        {{if $.Database.Supports.FkNames}}
        <td><span class="bare-value">{{.Name}}</span></td>
        {{end}}
        <td>
            <a href="{{.SourceTable}}?_rowLimit=100">
                {{.SourceTable}}({{.SourceColumns}})
            </a>
        </td>
        <td><span class="bare-value">
            {{.DestinationColumns}}
        </span></td>
    </tr>
    {{end}}
    </tbody>
</table>
</div>
{{end}}

<h2 id="indexes">Indexes</h2>

<div class="fk-list">
{{if .Table.Indexes}}
    <table>
        <thead>
        <tr>
            <th>Name</th>
            <th>Columns</th>
            <th>Unique</th>
        </tr>
        </thead>
        <tbody>
        {{range .Table.Indexes}}
        <tr>
            <td><span class="bare-value">{{.Name}}</span></td>
            <td><span class="bare-value">{{.Columns.String}}</span></td>
            <td>
            {{if .IsUnique }}
                <span class="bare-value">Unique</span>
            {{end}}
            </td>
        </tr>
        {{end}}
        </tbody>
    </table>
</div>
{{end}}

<h2 id="data">Data</h2>


{{if .TableParams.CardView}}
    <div class="cards">
    {{ range .Rows }}
        {{$val := .}}
        {{$refsLen := len .}}
        {{$refsIndex := minus $refsLen 1}}
        <table class="card-view">
            {{ range $i, $col :=  $.Table.Columns }}
                <tr>
                    <th title='type: {{.Type}}'>
                        {{ if .IsInPrimaryKey}}<i class="fas fa-key" title="Primary Key"></i>{{end}}
                        {{.Name}}
                    </th>
                    <td>{{index $val $i}}</td>
                </tr>
            {{end}}
            {{if $.Table.InboundFks}}
            <tr>
                <th class='references'>Referenced by</th>
                <td>{{index $val $refsIndex}}</td>
            </tr>
            {{end}}
        </table>
    {{end}}
    </div>
{{else}}
    <table class="data-table-view">
        <thead>
        <tr>
            {{ range .Table.Columns }}
                <th title='Field data type: {{.Type}}' class="sortable">
                    <a href="?{{($.TableParams.AddSort .).AsQueryString}}#data" class="fk">
                        <span class="sort-markers">
                            {{ if $.TableParams.IsSorted . }}
                                {{ if $.TableParams.IsSortedAsc . }}
                                    <i class="fas fa-sort-up"> </i>
                                    asc
                                {{end}}
                                {{ if $.TableParams.IsSortedDesc . }}
                                    <i class="fas fa-sort-down"> </i>
                                    desc
                                {{end}}
                                {{ $.TableParams.SortPosition . }}
                            {{else}}
                                <i class="fas fa-sort"> </i> sort
                            {{end}}
                        </span>
                        <span class="column-name">
                            {{.Name}}
                            {{ if .IsInPrimaryKey}}<i class="fas fa-key" title="Primary Key"></i>{{end}}
                        </span>
                    </a>
                </th>
            {{end}}
            {{if $.Table.InboundFks}}
                <th class='references'>Referenced by</th>
            {{end}}
        </tr>
        </thead>
        {{ range .Rows }}
            <tr>
                {{ range . }}
                <td>{{.}}</td>
                {{end}}
            </tr>
        {{end}}
    </table>
{{end}}

<div class="sort-filter-info">

{{ if .TableParams.Filter }}
    <table class='filter-info'>
        <thead>
        <tr>
            <th colspan="2">
                Filter
            </th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td colspan="2">
                <a class="action-button button table-button" href="?{{$.TableParams.ClearFilter.AsQueryString}}#data">
                    <i class="fas fa-times"></i>
                    Clear Filter</a>
            </td>
        </tr>
        {{ range .TableParams.Filter }}
        <tr>
            <th>
            {{.Field}}
            </th>
            <td>
            {{ range .Values }}
                  {{.}}
                {{end}}
            </td>
        </tr>
        {{end}}
        </tbody>
    </table>
{{end}}

{{if .TableParams.Sort}}
    <table class='filter-info'>
        <thead>
        <tr>
            <th colspan="2">
                Sort
            </th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td colspan="2">
                <a class="action-button button table-button" href="?{{.TableParams.ClearSort.AsQueryString}}#data">
                    <i class="fas fa-sort"> </i>
                    Reset Sort Order</a>
            </td>
        </tr>
        {{ range .TableParams.Sort }}
        <tr>
            <td>
            {{.Column}}
            </td>
            <td>
            {{if .Descending}}
                <i class="fas fa-sort-down"> </i>
                Descending
            {{else}}
                <i class="fas fa-sort-up"> </i>
                Ascending
            {{end}}
            </td>
        </tr>
        {{end}}
        </tbody>
    </table>
{{end}}

    <form method="post" id="pageSizeForm">
    <table class='filter-info'>
        <thead>
        <tr>
            <th>
                Page
            </th>
        </tr>
        </thead>
        <tbody>
            {{ if .TableParams.RowLimit }}
            {{/* mssql doesn't support paging without a sort order */}}
            {{if or $.Database.Supports.PagingWithoutSorting $.TableParams.Sort}}
            {{if gt .TableParams.FromRow 1}}
            <tr>
            <td>
                <a class="action-button button" href="?{{.TableParams.PrevPage.AsQueryString}}#data">&lt; Previous Page</a>
            </td>
            </tr>
            {{end}}
            {{if len .Rows | le .TableParams.RowLimit}}
            <tr>
                <td>
                <a class="action-button button" href="?{{.TableParams.NextPage.AsQueryString}}#data">Next Page &gt;</a>
                </td>
                </tr>
            {{end}}
            {{else}}
            <tr>
            <td>
                <small class="hint" style="margin-left: 0.75em;">
                    <i class="fas fa-info-circle"></i>
                    Choose a sort order to enable paging
                </small>
            </td>
            </tr>
            {{end}}
            {{end}}
        <tr>
            <td>
                <button class="action-button button">Update page size</button>
            </td>
        </tr>
        <tr>
            <td>
                Rows {{.TableParams.FromRow}}
            {{if .TableParams.RowLimit}}
            {{if len .Rows | gt .TableParams.RowLimit}}
                to end
            {{else}}
                to {{.TableParams.ToRow}}
            {{end}}
            {{else}}
                onwards
            {{end}}
            </td>
        </tr>
        <tr>
            <td>
                <input type="number" name="_rowLimit" id="rowLimitInput" value="{{$.TableParams.RowLimit}}" size="5"/>
                    <br/>
                <label for="rowLimitInput">
                rows per page
                </label>
            </td>
        </tr>
    </table>
    </form>

    <table class='filter-info'>
        <thead>
        <tr>
            <th>
                Display
            </th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>
            {{if .TableParams.CardView}}
            {{/*todo: need a url builder to avoid ending up with ?& if there's no query*/}}
                <a class="action-button button table-button" href="?{{.TableParams.CardViewOff.AsQueryString}}#data">
                    <i class="fas fa-table"> </i>
                    Switch to table view</a>
            {{else}}
                <a class="action-button button table-button" href="?{{.TableParams.CardViewOn.AsQueryString}}#data">
                    <i class="fas fa-list"> </i>
                    Switch to card view</a>
            {{end}}
            </td>
        </tr>
    </table>

</div>

{{end}}
